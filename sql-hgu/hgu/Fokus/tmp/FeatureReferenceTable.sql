SELECT
  rtrim(RF.SOC)             AS SOC,
  rtrim(F.FEATURE_CODE)     AS FEATURE_CODE,
  rtrim(F.MPS_FEATURE_CODE) AS MPS_FEATURE_CODE,
  F.SERVICE_LEVEL,
  rtrim(F.FEATURE_DESC) AS FEATURE_DESC,
  rtrim(F.SWITCH_CODE)  AS SWITCH_CODE,
  F.CSM_PARAM_REQ_IND,
  rtrim(F.DEF_SW_PARAMS) AS DEF_SW_PARAMS,
  rtrim(F.FEATURE_TYPE)  AS FEATURE_TYPE,
  F.MSISDN_CRITERIA,
  rtrim(F.TN_CLASS_CD) AS TN_CLASS_CD,
  RF.RC_INFO_IND,
  FT.MUTUAL_EXCLUS_IND,
  rtrim(FT.SWITCH_CODE)        AS TYPE_SWITCH_CODE,
  rtrim(RF.FR_FM_PLAN_CD)      AS FR_FM_PLAN_CD,
  NVL(RF.MAX_MEMBERS, 0)       AS MAX_MEMBERS,
  NVL(RF.FR_FM_FREE_DIGITS, 0) AS FR_FM_FREE_DIGITS
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC(
  sysdate + 1))
ORDER BY
  soc,
  feature_code
;

SELECT count(1)
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC(
  sysdate + 1))
; -- 26124


select * from (
SELECT
  rtrim(F.FEATURE_CODE)     AS FEATURE_CODE,
  rtrim(F.MPS_FEATURE_CODE) AS MPS_FEATURE_CODE,
  F.SERVICE_LEVEL,
  rtrim(F.FEATURE_DESC) AS FEATURE_DESC,
  rtrim(F.SWITCH_CODE)  AS SWITCH_CODE,
  F.CSM_PARAM_REQ_IND,
  rtrim(F.DEF_SW_PARAMS) AS DEF_SW_PARAMS,
  rtrim(F.FEATURE_TYPE)  AS FEATURE_TYPE,
  F.MSISDN_CRITERIA,
  rtrim(F.TN_CLASS_CD) AS TN_CLASS_CD,
  RF.RC_INFO_IND,
  FT.MUTUAL_EXCLUS_IND,
  rtrim(FT.SWITCH_CODE)        AS TYPE_SWITCH_CODE,
  rtrim(RF.FR_FM_PLAN_CD)      AS FR_FM_PLAN_CD,
  NVL(RF.MAX_MEMBERS, 0)       AS MAX_MEMBERS,
  NVL(RF.FR_FM_FREE_DIGITS, 0) AS FR_FM_FREE_DIGITS
  , count(1) as "COUNT"
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC( sysdate + 1))
group by rtrim(F.FEATURE_CODE),  rtrim(F.MPS_FEATURE_CODE),  F.SERVICE_LEVEL,  rtrim(F.FEATURE_DESC),  rtrim(F.SWITCH_CODE) ,  F.CSM_PARAM_REQ_IND,  rtrim(F.DEF_SW_PARAMS),  rtrim(F.FEATURE_TYPE),  F.MSISDN_CRITERIA,  rtrim(F.TN_CLASS_CD),  RF.RC_INFO_IND,  FT.MUTUAL_EXCLUS_IND,  rtrim(FT.SWITCH_CODE),  rtrim(RF.FR_FM_PLAN_CD),  NVL(RF.MAX_MEMBERS, 0),  NVL(RF.FR_FM_FREE_DIGITS, 0)
)
ORDER BY "COUNT" DESC
; -- 1186 unique rows (1186-474)=712 rows with only one soc...


select * from (
SELECT
  rtrim(F.FEATURE_CODE)     AS FEATURE_CODE
  , count(1) as "COUNT"
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC( sysdate + 1))
group by rtrim(F.FEATURE_CODE)
)
ORDER BY "COUNT" DESC
; -- 1177 unique rows


select FEATURE_CODE, count(1) as "COUNT" from (
SELECT
  rtrim(F.FEATURE_CODE)     AS FEATURE_CODE,
  rtrim(F.MPS_FEATURE_CODE) AS MPS_FEATURE_CODE,
  F.SERVICE_LEVEL,
  rtrim(F.FEATURE_DESC) AS FEATURE_DESC,
  rtrim(F.SWITCH_CODE)  AS SWITCH_CODE,
  F.CSM_PARAM_REQ_IND,
  rtrim(F.DEF_SW_PARAMS) AS DEF_SW_PARAMS,
  rtrim(F.FEATURE_TYPE)  AS FEATURE_TYPE,
  F.MSISDN_CRITERIA,
  rtrim(F.TN_CLASS_CD) AS TN_CLASS_CD,
  RF.RC_INFO_IND,
  FT.MUTUAL_EXCLUS_IND,
  rtrim(FT.SWITCH_CODE)        AS TYPE_SWITCH_CODE,
  rtrim(RF.FR_FM_PLAN_CD)      AS FR_FM_PLAN_CD,
  NVL(RF.MAX_MEMBERS, 0)       AS MAX_MEMBERS,
  NVL(RF.FR_FM_FREE_DIGITS, 0) AS FR_FM_FREE_DIGITS
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC( sysdate + 1))
group by rtrim(F.FEATURE_CODE),  rtrim(F.MPS_FEATURE_CODE),  F.SERVICE_LEVEL,  rtrim(F.FEATURE_DESC),  rtrim(F.SWITCH_CODE) ,  F.CSM_PARAM_REQ_IND,  rtrim(F.DEF_SW_PARAMS),  rtrim(F.FEATURE_TYPE),  F.MSISDN_CRITERIA,  rtrim(F.TN_CLASS_CD),  RF.RC_INFO_IND,  FT.MUTUAL_EXCLUS_IND,  rtrim(FT.SWITCH_CODE),  rtrim(RF.FR_FM_PLAN_CD),  NVL(RF.MAX_MEMBERS, 0),  NVL(RF.FR_FM_FREE_DIGITS, 0)
)
group by "FEATURE_CODE"
order by "COUNT" DESC
;

select * from (
SELECT
  rtrim(F.FEATURE_CODE)     AS FEATURE_CODE,
  rtrim(F.MPS_FEATURE_CODE) AS MPS_FEATURE_CODE,
  F.SERVICE_LEVEL,
  rtrim(F.FEATURE_DESC) AS FEATURE_DESC,
  rtrim(F.SWITCH_CODE)  AS SWITCH_CODE,
  F.CSM_PARAM_REQ_IND,
  rtrim(F.DEF_SW_PARAMS) AS DEF_SW_PARAMS,
  rtrim(F.FEATURE_TYPE)  AS FEATURE_TYPE,
  F.MSISDN_CRITERIA,
  rtrim(F.TN_CLASS_CD) AS TN_CLASS_CD,
  RF.RC_INFO_IND,
  FT.MUTUAL_EXCLUS_IND,
  rtrim(FT.SWITCH_CODE)        AS TYPE_SWITCH_CODE,
  rtrim(RF.FR_FM_PLAN_CD)      AS FR_FM_PLAN_CD,
  NVL(RF.MAX_MEMBERS, 0)       AS MAX_MEMBERS,
  NVL(RF.FR_FM_FREE_DIGITS, 0) AS FR_FM_FREE_DIGITS
  , count(1) as "COUNT"
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC(sysdate + 1))
and rtrim(F.FEATURE_CODE) in ( 'F&FCHE', 'M-CET2', 'RGSMIF', 'RMMS', 'RVSADM', 'RTAXI', 'RUMTS', 'RVMS', 'RNRD' )
group by rtrim(F.FEATURE_CODE),  rtrim(F.MPS_FEATURE_CODE),  F.SERVICE_LEVEL,  rtrim(F.FEATURE_DESC),  rtrim(F.SWITCH_CODE) ,  F.CSM_PARAM_REQ_IND,  rtrim(F.DEF_SW_PARAMS),  rtrim(F.FEATURE_TYPE),  F.MSISDN_CRITERIA,  rtrim(F.TN_CLASS_CD),  RF.RC_INFO_IND,  FT.MUTUAL_EXCLUS_IND,  rtrim(FT.SWITCH_CODE),  rtrim(RF.FR_FM_PLAN_CD),  NVL(RF.MAX_MEMBERS, 0),  NVL(RF.FR_FM_FREE_DIGITS, 0)
)
ORDER BY
  feature_code
;

select max("COUNT") as "MAX", min("COUNT") as "MIN", avg("COUNT") as "AVG"
from (
SELECT
  rtrim(RF.SOC), count(1) as "COUNT"
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC( sysdate + 1))
group by rtrim(RF.SOC)
ORDER BY rtrim(RF.SOC)
)
;

select count(1) as "COUNT_SOCS" from (
SELECT
  rtrim(RF.SOC), count(1) as "COUNT"
FROM
  RATED_FEATURE RF,
  FEATURE F,
  FEATURE_TYPES FT
WHERE
  F.FEATURE_CODE    = RF.FEATURE_CODE
AND F.FEATURE_GROUP = 'SF'
AND FT.FEATURE_TYPE = F.FEATURE_TYPE
AND TRUNC(sysdate) BETWEEN RF.EFFECTIVE_DATE AND NVL(RF.EXPIRATION_DATE, TRUNC( sysdate + 1))
group by rtrim(RF.SOC)
ORDER BY rtrim(RF.SOC)
)
;